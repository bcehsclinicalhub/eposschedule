<!DOCTYPE html>
<html>
<head>
  <title>BCEHS Schedule</title>
  <style>
    body { font-family: Arial; margin: 2em; }
    .schedule-day { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>BCEHS Schedule</h1>
  <div id="schedule"></div>

  <script>
    const proxy = "https://corsproxy.io/?";
    const scheduleURL = proxy + encodeURIComponent("https://ca.bytebloc.com/sk/Svc/getMasterSchedule/V5/BCEHS/BCEHS/d31648c6853e464aa71c9ff0be062f2a?format=XML");
    const userDetailsURL = proxy + encodeURIComponent("https://ca.bytebloc.com/sk/Svc/getUserDetails/V1/BCEHS/BCEHS/d31648c6853e464aa71c9ff0be062f2a?providersonly=false");

    async function fetchXML(url) {
      const response = await fetch(url);
      const text = await response.text();
      return new window.DOMParser().parseFromString(text, "text/xml");
    }

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    async function loadSchedule() {
      const xml = await fetchXML(scheduleURL);
      const today = formatDate(new Date());
      const tomorrow = formatDate(new Date(Date.now() + 86400000));
      const scheduleDiv = document.getElementById('schedule');

      const shifts = [...xml.querySelectorAll("MasterScheduleData")];
      const display = { today: [], tomorrow: [] };

      shifts.forEach(shift => {
        const date = shift.querySelector("ShiftDate")?.textContent;
        const name = shift.querySelector("ResourceName")?.textContent;
        const site = shift.querySelector("SiteName")?.textContent;
        const time = shift.querySelector("StartTime")?.textContent + " - " + shift.querySelector("EndTime")?.textContent;

        if (date === today) display.today.push({ name, site, time });
        if (date === tomorrow) display.tomorrow.push({ name, site, time });
      });

      ["today", "tomorrow"].forEach(day => {
        const dayDiv = document.createElement("div");
        dayDiv.className = "schedule-day";
        dayDiv.innerHTML = `<h2>${day.toUpperCase()}</h2>` +
          (display[day].length === 0 ? "<p>No shifts</p>" :
          "<ul>" + display[day].map(s => `<li>${s.name} @ ${s.site} (${s.time})</li>`).join('') + "</ul>");
        scheduleDiv.appendChild(dayDiv);
      });
    }

    loadSchedule();
  </script>
</body>
</html>
